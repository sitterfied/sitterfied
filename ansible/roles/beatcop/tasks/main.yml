---

- name: create the beatcop config directory
  become: true
  file:
    dest=/etc/beatcop.d/
    owner=root
    group=root
    mode=755
    state=directory

- name: create the celerybeat beatcop config
  become: true
  template:
    src=celerybeat.ini.j2
    dest=/etc/beatcop.d/celerybeat.ini
    owner=root
    group=root
    mode=644
  notify:
    - restart beatcop

- name: create the beatcop upstart script
  become: true
  template:
    src=beatcop.conf.j2
    dest=/etc/init/beatcop.conf
    owner=root
    group=root
    mode=644
  notify:
    - restart beatcop

- name: create the beatcop python script
  become: true
  copy:
    src=beatcop
    dest="{{ api_virtualenv_bin }}/beatcop"
    owner="{{ api_user }}"
    group="{{ api_user }}"
    mode=0775
  notify:
    - restart beatcop

- name: start and enable the beatcop service
  become: true
  service:
    name=beatcop
    state=started
    enabled=True
