# Rewrite http requests to https
if ($http_x_forwarded_port != 443) {
    rewrite ^ https://$http_host/;
}

# Proxy community requests to the appropriate forum
location ~* /community/(.*)/ {
   proxy_pass https://$1-sitterfied.rhcloud.com;
}

gzip             on;
gzip_min_length  1000;
gzip_proxied     expired no-cache no-store private auth;
gzip_types application/x-javascript text/css;
gzip_http_version 1.0;
client_max_body_size 6M;

location /static/ {
   alias /home/dotcloud/current/sitterfied/static/;
   add_header X-what static;
}

location /media/ {
   alias /home/dotcloud/data/media/;
   add_header X-what media;
}
